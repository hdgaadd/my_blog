![微信截图_20240320181136](E:\z-relax\my_blog\2024.3.20\Snipaste_2024-03-20_20-05-29.png)

> *面试官：听说你精通Kafka，那我就考考你吧*
>
> <br/>
>
> *面试官：不用慌尽管说，错了也没关系😊。。。*
>
> <br/>
>
> **以【面试官面试】的形式来分享技术，本期是《Kafka系列》，感兴趣就关注我吧**❤️

## 面试官：知道Kafka高水位吗

当前高水位就是复制偏移量嘛，记录了当前**已提交消息的最大偏移量**。

是这样的，Kafka的消息只有在**所有分区副本**都同步该消息后，才算是**已提交**的消息。

分区副本会根据**首领分区副本**提供的高水位，来避免**未提交**的消息被消费。

![微信截图_20240320180843](E:\z-relax\my_blog\2024.3.20\微信截图_20240320180843.png)

> <br/>
>
> *面试官思考中…*
>
> <br/>

## 面试官：你说说怎么保证Kafka消息的可靠性

嗯嗯好的。

在Broker方面，主要使用了**分区多副本架构**，来保证消息不丢失。

Kafka集群的每一个分区的**首领副本**，都会有n（**复制系数**）个broker机器去复制后，生成**跟随者副本**。

同时如果首领副本的机器挂了，跟随者副本会选举成为**新的首领副本**。

分区有多个备份是消息保存的一个可靠性保障。

> <br/>
>
> *面试官思考中…*
>
> <br/>

## 面试官：还有吗，比如生产者消费者呢

噢噢还有的，还有在生产者、消费者方面的可靠性。

一、在生产者方面

1. 提供了**ack = all**这种**发送确认机制**

  也就是只有在消息成功**写入所有副本**后，才算该消息已提交

  另外还有ack = 0通过网络成功发送也就是异步提交、ack = 1成功保存首领副本。

2. ack = all失败的话，生产者可以有**重试机制**

二、在消费者方面

1. 消费者消费时，会根据偏移量进行消费，保证了**消息的顺序性**
2. 消费后会同步提交、异步**提交偏移量**，保证了消息不被**重复消费**

> <br/>
>
> *面试官思考中…*
>
> <br/>

## 面试官：那要是Kafka消费堆积了怎么办

这样的话，要从Broker和消费者两方面来看。

一、Broker的话
1. 每个topic是分为多个分区给不同Broker处理，要**合理分配分区数量**来提高Broker的消息处理能力。比如3个Broker2个分区，可以改为3个Broker3个分区
2. 也可以**横向扩展**Broker集群

二、消费者的话
1. 可以提高消费者服务数量
2. 提交偏移量时，可以把同步提交改为**异步提交**，来减少同步等待Broker的时间

> <br/>
>
> *面试官思考中…*
>
> <br/>

## 面试官：知道Kafka控制器吧

嗯嗯知道的。控制器其实也是一个broker，不过它还负责选举**分区首领**。

也就是在首领副本所在的分区失效后，通过控制器来在分区副本里选举出新的**首领副本**。

> *面试官抓抓脑袋，继续看你的简历......*
>
> <br/>
>
> *得想想考点你不懂的😰*

## 未完待续。。。。。。

好了，今天的分享就先到这，我们下期【Kafka系列】继续。

> **创作不易，不妨点赞、收藏、关注支持一下，各位的支持就是我创作的最大动力**❤️