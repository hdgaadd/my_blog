> *面试官：咳咳咳，看你简历写了精通Redis，那我就随便考考你吧*
>
> <br/>
>
> *面试官：不用慌尽管说，错了也没关系😊。。。*

## 面试官：Redis哨兵知道吧

知道的，Sentinel哨兵本质是一个运行在特殊模式下的Redis服务器。

> <br/>
>
> *面试官思考中…*
>
> <br/>

## 面试官：嗯然后呢？

emmmm。Sentinel哨兵可以是单个节点或是多个节点组成的哨兵系统。

它的主要作用是通过检测**Redis主从服务器**的下线状态，**选举出新Redis主服务器**，也就是**故障转移**，来保证Redis的高可用性。

![在这里插入图片描述](https://img-blog.csdnimg.cn/direct/cdb354bdbb064ebd9ee0297e2a359293.png#pic_center)

> <br/>
>
> *面试官思考中…*
>
> <br/>

## 面试官：你说说是怎么检测Redis主从服务器的下线状态的

好的面试官。检测下线状态有两种方式。

1. **检测主观下线状态**的话，默认情况Sentinel会每隔1s向Redis主、从服务器发送PING命令，通过返回的信息来判断下线状态
2. **检测客观下线状态**的话，是Sentinl在主观判断下线后，会向其他Sentinel进行询问**是否同意**该节点已下线，当标记下线的**数量足够多**就会判断客观下线

![在这里插入图片描述](https://img-blog.csdnimg.cn/direct/44d8e08cde024a3aaf4c9441a61da0da.png#pic_center)

> <br/>
>
> *面试官思考中…*
>
> <br/>

## 面试官：有没有A哨兵判断Redis实例下线，但B哨兵判断Redis实例仍然存活的情况呢

有的面试官，主要还是看各个**哨兵的配置**。

像检测主观下线状态的话，要看Sentinel判断Redis实例进入主观下线**所需的响应时间长度**。A哨兵的配置是10000毫秒、B哨兵是5000毫秒，但Redis实例要在20000毫秒才响应，像这种情况就会发生。

而检测客观下线状态的话，要看配置需要其他Sentinel同意主服务器**已下线的数量**。

> <br/>
>
> *面试官思考中…*
>
> <br/>

## 面试官：领头哨兵怎么选举出来的

是这样的，Sentinel设置局部领头Sentinel的规则是**先到先得**。

最先向**目标Sentinel**发送设置要求的源Sentinel将成为目标Sentinel的**局部领头Sentinel**，而之后接收到的所有设置要求都会被目标Sentinel拒绝。

如果有某个Sentinel被**半数以上**的Sentinel设置成了局部领头Sentinel，那么这个Sentinel就会成为领头Sentinel。

> <br/>
>
> *面试官思考中…*
>
> <br/>

## 面试官：选举出来之后呢，它有什么作用吗

**领头Sentinel**主要是执行故障转移，也就是**选举出新的Redis主服务器**，而且只有当Redis主服务器被判断**客观下线**后才会选举出领头Sentinel。

> <br/>
>
> *面试官思考中…*
>
> <br/>

## 面试官：知道怎么选举新的Redis主服务器吗

哦哦我整理下。

- 领头Sentinel会将已下线Redis主服务器的所有Redis从服务器保存到一个列表里面
- 通过**删除策略**，删除所有处于下线或者断线状态的、删除最近五秒内没有回复过领头Sentinel命令的、删除与已下线主服务器连接断开超过10毫秒的
- 如果有多个相同优先级的从服务器，将按照**复制偏移量**进行排序选出偏移量最大的，复制偏移量最大也就是数据同步最新的
- 最后选出的Redis实例也就成为新的Redis主服务器

![在这里插入图片描述](https://img-blog.csdnimg.cn/direct/c0bdd8b3a619423fa96e0b1916b41c53.png#pic_center)

> *面试官抓抓脑袋，继续看你的简历......*
>
> <br/>
>
> *emmmm，得想想考点你不懂的*

## 未完待续。。。。。。

好了，今天的分享就先到这，我们下期继续。

> 博主GitHub也有一些读者感兴趣的💪，[GitHub戳这](https://github.com/hdgaadd)，你的 ⭐️ Star ⭐️，是作者的动力！
>
> <br/>
>
> 博客首发：[掘金](https://juejin.cn/user/853686632850381/posts)、[CSDN](https://blog.csdn.net/hdgaadd)
>
> <br/>
>
> **创作不易，不妨点赞、收藏、关注支持一下，各位的支持就是我创作的最大动力**❤️