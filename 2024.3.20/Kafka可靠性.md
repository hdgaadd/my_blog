> *面试官：听说你精通Kafka，那我就考考你吧*
>
> <br/>
>
> *面试官：不用慌尽管说，错了也没关系😊。。。*
>
> <br/>
>
> **以【面试官面试】的形式来分享技术，本期是《Kafka系列》，感兴趣就关注我吧**❤️

## 知道Kafka高水位吗

当前高水位标记，指的**分区首领**会发送给跟随者副本**最近提交的偏移量**。







## 你说说怎么保证Kafka消息的可靠性

在Broker方面，主要使用了**分区多副本架构**，来保证消息不丢失。

Kafka集群的每一个分区的**首领副本**，都会有n（**复制系数**）个broker机器去复制它后生成**跟随者副本**。

同时如果首领副本的机器挂了，跟随者副本会选举成为**新的首领副本**。

> <br/>
>
> *面试官思考中…*
>
> <br/>

## 还有吗，比如生产者消费者呢

噢噢还有的，还有在生产者、消费者方面的支撑。

1. 在生产者方面

   - 提供了**ack = all**这种**发送确认机制**

     也就是只有在消息成功写入所有副本后，才算该消息已提交

     另外还有ack = 0通过网络成功发送也就是异步提交、ack = 1成功保存首领副本。

   - ack = all失败的话，生产者可以有**重试机制**

2. 在消费者方面

   1. 消费者消费时，会根据偏移量进行消费，保证**消息的顺序性**
   2. 消费后会同步、异步**提交偏移量**，保证消息不被**重复消费**

> <br/>
>
> *面试官思考中…*
>
> <br/>

## 那要是Kafka消费堆积了怎么办

这样的话，要看Broker和消费者两方面来看。

1. Broker的话
   - 每个topic分为多个分区给不同Broker处理，要**合理分配分区数量**来提高Broker的消息处理能力，比如3个Broker2个分区，可以改为3个Broker3个分区
   - 也可以**横向扩展**Broker集群
2. 消费者的话
   1. 提高消费者服务数量
   2. 提交偏移量时，可以把同步提交改为**异步提交**

> <br/>
>
> *面试官思考中…*
>
> <br/>

## 知道Kafka控制器吧

嗯嗯知道的。控制器其实也是一个broker，不过它还负责选举**分区首领**。

也就是在首领副本所在的分区失效后，在分区副本里选举出新的**首领副本**。



> *面试官抓抓脑袋，继续看你的简历......*
>
> <br/>
>
> *得想想考点你不懂的😰*

## 未完待续。。。。。。

好了，今天的分享就先到这，我们下期继续。

> **创作不易，不妨点赞、收藏、关注支持一下，各位的支持就是我创作的最大动力**❤️